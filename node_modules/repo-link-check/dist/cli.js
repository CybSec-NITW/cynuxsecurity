#!/bin/node
(()=>{"use strict";var n={271:n=>{n.exports=require("bottleneck")},129:n=>{n.exports=require("child_process")},647:n=>{n.exports=require("commander")},710:n=>{n.exports=require("fast-glob")},747:n=>{n.exports=require("fs")},675:n=>{n.exports=require("js-yaml")},665:n=>{n.exports=require("lodash/defaults")},645:n=>{n.exports=require("micromatch")},786:n=>{n.exports=require("node-fetch")},622:n=>{n.exports=require("path")}},t={};function e(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return n[r](i,i.exports,e),i.exports}e.n=n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},e.d=(n,t)=>{for(var r in t)e.o(t,r)&&!e.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:t[r]})},e.o=(n,t)=>Object.prototype.hasOwnProperty.call(n,t),(()=>{var n=e(665),t=e.n(n),r=e(786),i=e.n(r),o=e(622),u=e.n(o),a=e(747),l=e.n(a),c=e(129),s=e(710),f=e.n(s),p=e(647),h=e(645),d=e.n(h),v=e(271),y=e.n(v),b=function(){return(b=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}).apply(this,arguments)},w=function(n,t,e,r){return new(e||(e=Promise))((function(i,o){function u(n){try{l(r.next(n))}catch(n){o(n)}}function a(n){try{l(r.throw(n))}catch(n){o(n)}}function l(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(u,a)}l((r=r.apply(n,t||[])).next())}))},m=function(n,t){var e,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(n,u)}catch(n){o=[6,n],r=0}finally{e=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},g=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]])}return e},k={},x=function(n,t){if(!k[n]){var e=Object.entries(t.linkOptions).find((function(t){var e=t[0];return d().isMatch(n,e)})),r=e?e[1]:{},i=r.minTime,o=void 0===i?t.minTime||400:i,u=r.maxConcurrent,a=void 0===u?t.maxConcurrent||1:u;k[n]=new(y())({minTime:o,maxConcurrent:a})}return k[n]},P=function(n,t,e){return w(void 0,void 0,void 0,(function(){return m(this,(function(r){return[2,x(n.hostname,e).schedule((function(){return i()(n.href,t)}))]}))}))},O=function(n,t,e){return void 0===t&&(t={}),w(void 0,void 0,void 0,(function(){var r,i,o,u,a,l,c;return m(this,(function(s){switch(s.label){case 0:return r=t.retries,i=void 0===r?0:r,o=e.maxRetries,u=void 0===o?3:o,[4,P(n,b(b({},t),{method:"HEAD"}),e)];case 1:if(429===(a=s.sent()).status&&i<u){if(l=a.headers.get("retry-after"))return c=1e3*Number(l),[2,new Promise((function(r){setTimeout((function(){return w(void 0,void 0,void 0,(function(){var o;return m(this,(function(u){switch(u.label){case 0:return o=r,[4,O(n,b(b({},t),{retries:i+1}),e)];case 1:return o.apply(void 0,[u.sent()]),[2]}}))}))}),c)}))]}else if(!a.ok)return[2,P(n,b(b({},t),{method:"GET"}),e)];return[2,a]}}))}))},E={},S=function(n,t){return w(void 0,void 0,void 0,(function(){var e,r;return m(this,(function(i){return e=n.href,(r=E[e])?[2,r]:(E[e]=O(n,{},t),[2,E[e]])}))}))},A=new Set;const j=function(n,t){var e=n.link,r=n.url;return w(void 0,void 0,void 0,(function(){var n,i,o,u,a,l,c,s,f;return m(this,(function(p){switch(p.label){case 0:if(n=t.linkIncludePatterns,i=t.linkExcludePatterns,o=t.dryRun,!function(n,t,e){var r=e.ignore,i=g(e,["ignore"]);if(d().isMatch(n,t,i)){if(r)if(Array.isArray(r)){var o=r.find((function(t){return d().isMatch(n,t,i)}));if(o)return A.add(o),!1}else if(d().isMatch(n,r,i))return A.add(r),!1;return!0}return!1}(e,n,{ignore:i,bash:!0}))return[3,5];if(u=r.href,o)return[2,{link:e,href:e===u?null:u,description:"Skipped because of dry-run",pass:!0}];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,S(r,t)];case 2:return a=p.sent(),l=a.status,c=a.ok,[2,{link:e,href:e===u?null:u,description:l,pass:c}];case 3:switch(s=p.sent(),f={link:e,href:u,pass:!1},s.code){case"ENOTFOUND":f.description="Site not found";break;default:f.description=[s.code||"Fetch Error",s.message&&": "+s.message].filter(Boolean).join("")}return[2,f];case 4:return[3,6];case 5:return[2,{link:e,description:"Excluded",pass:!0}];case 6:return[2]}}))}))};var I=function(n,t,e){void 0===e&&(e=function(n){return n[1]});for(var r=[],i=t.exec(n);null!==i;){var o=e(i);o&&r.push(o),i=t.exec(n)}return r},F=function(n,t){switch(u().extname(n)){case".md":case".mdx":var e=I(t,/\[.*?\]\((?:<((?:\(.*?\)|.)*?)>|((?:\(.*?\)|.)*?))(?: ["'].*?["'])?\)/gm,(function(n){return n[2]||n[1]})),r=I(t,/href="(.*?)"/gm),i=e.concat(r);return i?i.filter(Boolean).map((function(n){return n.startsWith("/static")?n.slice(7):n})):null;case".html":return I(t,/href="(.*?)"/gm);case".json":return I(t,/"(?:(?:https?:)?\/\/)?(?:)"/gm);default:return I(t,/(((https?:\/\/)[A-Za-z0-9.-]+|(?:www\.)[A-Za-z0-9.-]+)((?:\/[+~%/.\w\-_]*)?\??(?:[-+=&;%@.\w_]*)#?(?:[.!/\\\w]*))?)/gm,(function(n){return n[0]}))}};const T=function(n){var t=n.filePath,e=n.content;return(Array.isArray(e)?[].concat.apply([],e.map((function(n){return F(t,n)}))):F(t,e)).filter((function(n){return n&&!n.startsWith("#")}))};var C=function(n,t,e,r){return new(e||(e=Promise))((function(i,o){function u(n){try{l(r.next(n))}catch(n){o(n)}}function a(n){try{l(r.throw(n))}catch(n){o(n)}}function l(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(u,a)}l((r=r.apply(n,t||[])).next())}))},R=function(n,t){var e,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(n,u)}catch(n){o=[6,n],r=0}finally{e=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},U=function(n,t){return C(void 0,void 0,void 0,(function(){return R(this,(function(e){return[2,new Promise((function(e,r){l().readFile(n,"utf-8",(function(n,i){n&&r(n),e(t(i))}))}))]}))}))};function q(n,t){return C(this,void 0,void 0,(function(){return R(this,(function(e){return[2,Promise.all(n.map(t))]}))}))}var G=function(n,t,e,r){return new(e||(e=Promise))((function(i,o){function u(n){try{l(r.next(n))}catch(n){o(n)}}function a(n){try{l(r.throw(n))}catch(n){o(n)}}function l(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(u,a)}l((r=r.apply(n,t||[])).next())}))},L=function(n,t){var e,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(n,u)}catch(n){o=[6,n],r=0}finally{e=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},B=function(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;var r=Array(n),i=0;for(t=0;t<e;t++)for(var o=arguments[t],u=0,a=o.length;u<a;u++,i++)r[i]=o[u];return r},M=function(n,t){var e=n.filePath,r=n.content;return G(void 0,void 0,void 0,(function(){var n,i,o;return L(this,(function(u){switch(u.label){case 0:return n=t.rootURL,o={filePath:e},[4,"function"==typeof r?r(e):r];case 1:return o.content=u.sent(),[4,q(T(o),(function(e){return G(void 0,void 0,void 0,(function(){var r;return L(this,(function(i){switch(i.label){case 0:return(r=function(n,t){try{return new URL(/^(https?:\/)?\//.test(n)?n:"https://"+n,t)}catch(n){return null}}(e,n))?[4,j({link:e,url:r},t)]:[2,null];case 1:return[2,i.sent()]}}))}))}))];case 2:return i=u.sent().filter(Boolean),[2,{filePath:e,checks:i}]}}))}))};function _(n,t){return G(this,void 0,void 0,(function(){var e,r,i,o,u;return L(this,(function(a){switch(a.label){case 0:return[4,q(n,(function(n){return M(n,t)}))];case 1:return e=a.sent(),r=e.reduce((function(n,t){var e=n[0],r=n[1],i=n[2],o=t.filePath,u=t.checks,a=u.filter((function(n){return!n.pass}));return[e+u.length,r+a.length,a.length>0?B(i,[{filePath:o,checks:a}]):i]}),[0,0,[]]),i=r[0],o=r[1],u=r[2],[2,{entries:e,failedEntries:u,totalChecksCount:i,failedChecksCount:o,unusedPatterns:(l=t.linkExcludePatterns,l?l.filter((function(n){return!A.has(n)})):[])}]}var l}))}))}var N=e(675),z=e.n(N),D=function(){return(D=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}).apply(this,arguments)},W=function(n,t,e,r){return new(e||(e=Promise))((function(i,o){function u(n){try{l(r.next(n))}catch(n){o(n)}}function a(n){try{l(r.throw(n))}catch(n){o(n)}}function l(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(u,a)}l((r=r.apply(n,t||[])).next())}))},Z=function(n,t){var e,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(n,u)}catch(n){o=[6,n],r=0}finally{e=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},H=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]])}return e},J=function(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;var r=Array(n),i=0;for(t=0;t<e;t++)for(var o=arguments[t],u=0,a=o.length;u<a;u++,i++)r[i]=o[u];return r},K=function(n){if(n){if(!Array.isArray(n))return n;if(n.length>0)return n}return"**"};function Q(n){return W(this,void 0,void 0,(function(){var t;return Z(this,(function(e){if(!n)return[2,null];switch(t=u().extname(n)){case".yml":case".yaml":return[2,U(n,(function(n){return z().safeLoad(String(n))}))];case".json":return[2,U(n,(function(n){return JSON.parse(String(n))}))];default:throw new Error('Options file "'+n+'" has unrecognized extension "'+t+'"')}return[2]}))}))}function V(n){return W(this,void 0,void 0,(function(){var t;return Z(this,(function(e){switch(e.label){case 0:return[4,Q(n)];case 1:if(t=e.sent(),!Array.isArray(t))throw new Error('File "'+n+'" is expected to be an Array, but was a '+typeof t+"!");return[2,t]}}))}))}function X(n){return W(this,void 0,void 0,(function(){var t,e,r,i,o;return Z(this,(function(u){switch(u.label){case 0:return n?Array.isArray(n)?(r=(e=(o=[]).concat).apply,i=[o],[4,q(n,V)]):[3,2]:[2,[]];case 1:return t=r.apply(e,i.concat([u.sent()])),[3,3];case 2:t=V(n),u.label=3;case 3:return[2,t]}}))}))}function Y(n){return W(this,void 0,void 0,(function(){var t=this;return Z(this,(function(e){return[2,q(n,(function(n){var e=n[0],r=n[1];return W(t,void 0,void 0,(function(){var n;return Z(this,(function(t){switch(t.label){case 0:return[4,X(e)];case 1:return n=t.sent(),[2,(r?n.concat(r):n).filter(Boolean)]}}))}))}))]}))}))}function $(n){return W(this,void 0,void 0,(function(){var e,r,i,o,u,a,l,c,s,f,p,h,d,v,y,b,w,m,g,k,x,P,O,E,S;return Z(this,(function(A){switch(A.label){case 0:return e=t().apply(void 0,J([{}],n.filter(Boolean))),r=e.diff,i=void 0!==r&&r,o=e.fileIncludePatterns,u=e.fileExcludePatterns,a=e.fileIncludePatternFile,l=e.fileExcludePatternFile,c=e.linkIncludePatterns,s=e.linkExcludePatterns,f=e.linkIncludePatternFile,p=e.linkExcludePatternFile,h=e.unusedPatternsOnly,d=e.dryRun,v=void 0===d?h:d,y=e.failOnUnusedPatterns,b=void 0===y?h:y,w=e.linkOptions,m=void 0===w?{}:w,g=e.output,k=H(e,["diff","fileIncludePatterns","fileExcludePatterns","fileIncludePatternFile","fileExcludePatternFile","linkIncludePatterns","linkExcludePatterns","linkIncludePatternFile","linkExcludePatternFile","unusedPatternsOnly","dryRun","failOnUnusedPatterns","linkOptions","output"]),[4,Y([[f,c],[p,s],[a,o],[l,u]])];case 1:return x=A.sent(),P=x[0],O=x[1],E=x[2],S=x[3],[2,D(D({},k),{diff:i,linkOptions:m,unusedPatternsOnly:h,dryRun:v,output:g&&(Array.isArray(g)?g:[g]),failOnUnusedPatterns:b,linkIncludePatterns:K(P),linkExcludePatterns:O,fileIncludePatterns:K(E),fileExcludePatterns:S})]}}))}))}var nn=function(n,t,e,r){return new(e||(e=Promise))((function(i,o){function u(n){try{l(r.next(n))}catch(n){o(n)}}function a(n){try{l(r.throw(n))}catch(n){o(n)}}function l(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(u,a)}l((r=r.apply(n,t||[])).next())}))},tn=function(n,t){var e,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(n,u)}catch(n){o=[6,n],r=0}finally{e=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},en=function(n){return new Promise((function(t,e){return(0,c.exec)(n,(function(n,r){return n?e(n):t(r)}))}))},rn=function(n){return nn(void 0,void 0,void 0,(function(){return tn(this,(function(t){switch(t.label){case 0:return[4,en("git remote remove origin")];case 1:return t.sent(),[4,en("git remote add origin "+n)];case 2:return t.sent(),[2]}}))}))};const on=function(n){var t=n.fileIncludePatterns,e=n.fileExcludePatterns,r=n.origin;return nn(void 0,void 0,void 0,(function(){var n,i,o,u,a;return tn(this,(function(l){switch(l.label){case 0:return r?[4,rn(r)]:[3,2];case 1:l.sent(),l.label=2;case 2:return[4,nn(void 0,void 0,void 0,(function(){return tn(this,(function(n){return[2,en("git diff -U0 --minimal origin/master")]}))}))];case 3:for(n=l.sent().split(/^diff --git.* b\/(.*)\n(?:.*\n){4}/gm),i=[],o=1;o<n.length;o+=2)u=n[o],d().isMatch(u,t,{ignore:e})&&(a=n[o+1].split("\n").filter((function(n){return n.startsWith("+")}))).length>0&&i.push({filePath:u,content:a});return[2,i]}}))}))};var un=function(n,t,e,r){return new(e||(e=Promise))((function(i,o){function u(n){try{l(r.next(n))}catch(n){o(n)}}function a(n){try{l(r.throw(n))}catch(n){o(n)}}function l(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(u,a)}l((r=r.apply(n,t||[])).next())}))},an=function(n,t){var e,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(n,u)}catch(n){o=[6,n],r=0}finally{e=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};const ln=function(n){var t=n.fileIncludePatterns,e=n.fileExcludePatterns;return un(this,void 0,void 0,(function(){var n=this;return an(this,(function(r){switch(r.label){case 0:return[4,f()(t,{ignore:e})];case 1:return[2,r.sent().map((function(t){return{filePath:t,content:function(t){return un(n,void 0,void 0,(function(){return an(this,(function(n){return[2,new Promise((function(n,e){return l().readFile(t,(function(t,r){return t?e(t):n(String(r))}))}))]}))}))}}}))]}}))}))};var cn=function(n,t,e,r){return new(e||(e=Promise))((function(i,o){function u(n){try{l(r.next(n))}catch(n){o(n)}}function a(n){try{l(r.throw(n))}catch(n){o(n)}}function l(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(u,a)}l((r=r.apply(n,t||[])).next())}))},sn=function(n,t){var e,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(n,u)}catch(n){o=[6,n],r=0}finally{e=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};const fn=function(n){return cn(this,void 0,void 0,(function(){return sn(this,(function(t){return[2,n.diff?on(n):ln(n)]}))}))};var pn=function(){return(pn=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var i in t=arguments[e])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n}).apply(this,arguments)},hn=function(n){return"* "+n.filePath+"\n"},dn=function(n){var t=n.link,e=n.href,r=n.description;return"  - "+(n.pass?"PASS":"FAIL")+": "+t+(e?" = "+e:"")+" ("+r+")"},vn=function(n,t){var e=n.filePath,r=n.checks,i=t.fileFormat,o=void 0===i?hn:i,u=t.linkFormat,a=void 0===u?dn:u,l=t.linkSeparator,c=void 0===l?"\n":l;return r.length>0?o({filePath:e,checks:r})+r.map(a).join(c):null},yn=function(n,t){return vn(n,pn({linkFormat:function(n){var t=n.link,e=n.href;return"  - "+t+(e?" = "+e:"")+" ("+n.description+")"},fileFormat:function(n){return"* "+n.filePath+"\n"}},t))};const bn=function(n,t){void 0===t&&(t={});var e=t.entryFormat,r=void 0===e?t.failsOnly?yn:vn:e,i=t.entrySeparator,o=void 0===i?"\n\n":i;return n.map((function(n,e){return r(n,t,e)})).filter(Boolean).join(o)};function wn(n){var t,e;console.log((void 0===e&&(e="\n\n"),(t=n)&&t.length>0?t.filter(Boolean).join(e):void 0))}var mn=function(n,t){var e=t.diff,r=t.unusedPatternsOnly,i=t.failsOnly,o=n.totalChecksCount,u=n.failedChecksCount,a=n.entries,l=n.failedEntries,c=n.unusedPatterns,s=[],f=i?l:a;if(0===o)s.push("There were no links to check!");else{var p=bn(f,{failsOnly:i});if(e)r&&console.warn("unusedPatternsOnly and diff are mutually exclusive! Skipping.");else if(c.length>0&&s.push("Some link ignore patterns were unused!\n\n"+c.join("\n")),r)return 0===c.length&&s.push("All link patterns were used."),wn(s);s.push(p),u>0?s.push(u+"/"+o+" links failed."):s.push("All "+o+" links passed!")}return wn(s)};const gn=function(n,t){var e=t.unusedPatternsOnly,r=n.unusedPatterns,i=n.failedChecksCount;e&&r.length>0&&process.exit(2),i>0&&process.exit(2),process.exit(0)};var kn=function(n,t,e,r){return new(e||(e=Promise))((function(i,o){function u(n){try{l(r.next(n))}catch(n){o(n)}}function a(n){try{l(r.throw(n))}catch(n){o(n)}}function l(n){var t;n.done?i(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(u,a)}l((r=r.apply(n,t||[])).next())}))},xn=function(n,t){var e,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=u.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=t.call(n,u)}catch(n){o=[6,n],r=0}finally{e=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},Pn=function(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;var r=Array(n),i=0;for(t=0;t<e;t++)for(var o=arguments[t],u=0,a=o.length;u<a;u++,i++)r[i]=o[u];return r};function On(n){return n.split(",")}function En(n,t){return t?Pn(t,[n]):[n]}!function(){kn(this,void 0,void 0,(function(){var n,t;return xn(this,(function(e){switch(e.label){case 0:return[4,kn(void 0,void 0,void 0,(function(){var n,t,e,r,i,o,u,a,l,c,s,f,h,d,v;return xn(this,(function(y){switch(y.label){case 0:return(n=new p.Command).name("repo-link-check").usage("[options]").option("-c, --configFile <path>","Path to the configuration file").option("-r, --rootURL <url>","Check root-relative links relative to this URL").option("-o, --output <strategy[,strategy]>","Use one or more strategies to generate report output",On).option("-d, --diff","Use git diff from origin/master as a source instead of the whole filesystem.").option("--dryRun","Skip checking parsed links and report them as skipped").option("-u, --unusedPatternsOnly","Do a dry run and exit after printing unused patterns").option("-f, --failsOnly","Only report failing links").option("-v, --verbose","Log fully resolved options").option("-li, --linkIncludePatterns <pattern>","Add a micromatch pattern used to whitelist links",En).option("-le, --linkExcludePatterns <pattern>","Add a micromatch pattern used to exclude links",En).option("-fi, --fileIncludePatterns <pattern>","Add a micromatch pattern used to whitelist files to scrape links from",En).option("-fe, --fileExcludePatterns <pattern>","Add a micromatch pattern used to exclude files to scrape links from",En).on("--help",(function(){console.log("\nTo specify multiple patterns, use the relevant flag multiple times.")})).parse(process.argv),t=n.configFile,e=n.diff,r=n.rootURL,i=n.fileIncludePatterns,o=n.fileExcludePatterns,u=n.linkIncludePatterns,a=n.linkExcludePatterns,l=n.unusedPatternsOnly,c=n.dryRun,s=void 0===c?l:c,f=n.failsOnly,h=n.verbose,d={diff:e,rootURL:r,fileIncludePatterns:i,fileExcludePatterns:o,linkIncludePatterns:u,linkExcludePatterns:a,unusedPatternsOnly:l,verbose:h,dryRun:s,failsOnly:f},[4,Q(t)];case 1:return v=y.sent(),[2,$([d,v])]}}))}))];case 1:return(n=e.sent()).verbose&&console.log("Options:",n),[4,fn(n)];case 2:return[4,_(e.sent(),n)];case 3:return t=e.sent(),mn(t,n),gn(t,n),[2]}}))}))}()})()})();